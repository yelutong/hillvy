<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
<title>优惠券</title>
<link rel="shortcut icon" href="images/favicon.ico" />
<link rel="stylesheet" type="text/css" href="min_css/public.css"> 
<link rel="stylesheet" type="text/css" href="min_css/content.css"> 
<link rel="stylesheet" type="text/css" href="min_css/user.css"/>
</head> 
<body>
<header class="header-box">
		<div class="header-menu" id="headerMenu">
		<span class="logo">优惠券</span>
		    <div class="header-icon left-icon"> 
					<a href="javascript:window.history.back()" class="icon_bk sprite"  ></a>
            </div>
			<div class="header-icon right-icon"> 
					<a href="shopcar.html" class="icon" ><i class="sprite gocar"></i><em></em></a>
            </div>
			</div>
</header>
<div class="content ticket">
<div class="ticketBox">
			<div class="hd">  
				<ul><li class="hd1">已领券</li><li class="hd2">使用记录</li><li class="hd3">已过期</li></ul>
			</div>
			<div class="ticketUl">
				<div class="bd">
					<ul class="takeOk"></ul>
					<ul class="takeList"></ul>
					<ul class="overTime"></ul>  
				</div> 
			</div>
		</div> 
</div>
<footer>
</footer> 
<div id="gotop">
  <div class="sprite gopic"></div> 
</div>  
</body>
</html>
<script type="text/javascript" src="min_js/jquery-1.10.1.min.js"></script>
<script type="text/javascript" src="min_js/api.js"></script>
<script type="text/javascript" src="min_js/commonUtil.js"></script>
<script type="text/javascript" src="min_js/jquery.md5.js" ></script>
<script type="text/javascript" src="min_js/vue.min.js" ></script> 
<script type="text/javascript" src="min_js/publick.js"></script>  
<script type="text/javascript" src="min_js/jquery.SuperSlide.2.1.1.js"></script> 
<script type="text/javascript" src="min_js/dropload.min21.js"></script>
<script>
  $("footer").load("footer.html"); 
  $(".ticketBox").slide({effect:"fade"});
  $(".ticketBox .ticketUl").css("height",window.screen.height-143);	
  $(function(){
	  $(".hd1").click(function(){
		if("obj_idok"==window.sessionStorage.getItem("obj_idok")){ 
			return false;
		}else{ 
		  window.sessionStorage.setItem("obj_idok","obj_idok"); 
		  $(".takeOk").empty();
		  $(".dropload-down").remove(); 
		  pageloadAll(".ticketUl",".takeOk",false,false);
		  setTimeout(function(){ 
				window.sessionStorage.removeItem('obj_idok');
		  },1000);
		}
	  })
	  $(".hd2").click(function(){
		if("obj_idok1"==window.sessionStorage.getItem("obj_idok1")){ 
			return false;
		}else{ 
		  window.sessionStorage.setItem("obj_idok1","obj_idok1"); 
		  $(".takeList").empty();
		  $(".dropload-down").remove();
		  pageloadAll(".ticketUl",".takeList",null,true);
		  setTimeout(function(){ 
				window.sessionStorage.removeItem('obj_idok1');
		  },1000);
		} 
	  })
	  $(".hd3").click(function(){ 
		if("obj_idok2"==window.sessionStorage.getItem("obj_idok2")){ 
			return false;
		}else{ 
		  window.sessionStorage.setItem("obj_idok2","obj_idok2"); 
		  $(".overTime").empty();
		  $(".dropload-down").remove();
		  pageloadAll(".ticketUl",".overTime",true,false); 
		  setTimeout(function(){ 
				window.sessionStorage.removeItem('obj_idok2');
		  },1000);
		}
	  })
  })	
</script>  
<script>
pageloadAll(".ticketUl",".takeOk",false,false);
function pageloadAll(dropClass,appendId,isPast,isUse){
	//总页数
	var totalPage = 1;//初始化
	//当前页
	var page = 0;

	// dropload
	$(dropClass).dropload({
		scrollArea : window,
		domDown : {
			domClass   : 'dropload-down', 
			domLoad    : '<div class="dropload-load" style="clear:both"><span class="loading"></span>加载中...</div>'
		},
		loadDownFn : function(me){  
			if(page< totalPage){
				page= parseInt(page) + 1; 
				//console.log("页码"+page);
				if(page==window.sessionStorage.getItem("pageok") && page>1){
					console.log("重复");
					return false;
				}else{
					window.sessionStorage.setItem("pageok",page);
				}  
				
				var result = '';
				var data21={ 
						"isPast":isPast,
						"isUse":isUse,
						"page" : page,
						"limit":8
					}  
			commonUtil.request({
					type: 'post',
					url: userCouponList, 
					dataType: 'json',
					cache : false,
					async : false,
					data : data21,
					success: function(data){
						//$("."+appendId+" i").html(data.content.totalCount);
						console.log(data);
						totalPage=data.content.totalPage; 
						if(totalPage==0||data.content.totalCount==0){
							$(dropClass+" .dropload-down").html("查询无数据");
							return false;
						}
						if(totalPage==1){
							setTimeout(function(){ 
							   $(dropClass+"  .dropload-down").html("已全部加载");
							},300);
							setTimeout(function(){ 
								$(dropClass+"  .dropload-down").hide();
							},500);
						}
						jQuery.each(data.content.list,function(i,v){   
							result += '<li>'+
								'<div class="coupon-left">'+
									'<p>'+v.title+'</p>'+
									'<p>'+v.content+'</p>'+
									'<p><i>'+v.validTimeStart.substring(0,10)+'</i> — <i>'+v.validTimeEnd.substring(0,10)+'</i></p>'+
								'</div>'+
								'<div class="coupon-right">'+
								'<div class="triangle-border-right"><em class="circular0"></em><em class="circular1"></em><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i></div>'+
								  '<p class="cp_price">¥<i>'+v.price+'</i></p>'+
								  '<p class="cp_requrePrice">消费满<i>'+v.requirePrice+'</i>可用</p>'+
								'</div>'+
							'</li>'; 
					  
						});
					},
					error: function(xhr, type){
						me.resetload();
					}
				}); 
				setTimeout(function(){
					$(appendId).append(result);
					me.resetload();  
				},500);

			}else{
				$(dropClass+"  .dropload-down").html("已全部加载");
				setTimeout(function(){
					$(dropClass+" .dropload-down").hide();
				},800);
			} 
			
		}
	}); 
			
	setTimeout(function(){
		var droploadDown=$(".dropload-down").html();
		console.log(droploadDown);
		if((droploadDown=="undefined"||droploadDown==undefined) && $(".hd1").hasClass("on")){
		    window.sessionStorage.removeItem('obj_idok');
			$(window).scrollTop(100);  
			//$(".hd1").click();	
			setTimeout(function(){
				$(window).scrollTop(0);
			},500)
		}
		else if((droploadDown=="undefined"||droploadDown==undefined) && $(".hd2").hasClass("on")){
		    window.sessionStorage.removeItem('obj_idok1');
			$(window).scrollTop(100); 
			//$(".hd2").click();	
			setTimeout(function(){
				$(window).scrollTop(0);
			},500)
		} 
		else if((droploadDown=="undefined"||droploadDown==undefined) && $(".hd3").hasClass("on")){
		    window.sessionStorage.removeItem('obj_idok2');
			$(window).scrollTop(100); 
			//$(".hd3").click();	
			setTimeout(function(){
				$(window).scrollTop(0);
			},500)
		} 
	},500);												  
													  
													  
													  
}	  
</script>  

