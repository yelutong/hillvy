webpackJsonp([35],{BEVu:function(t,e){},oTCQ:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=s("HzJ8"),a=s.n(o),i=s("3cXf"),r=s.n(i),n=s("4YfN"),c=s.n(n),d=s("9rMa"),u=s("wSez"),l=s("9yBd"),g=s("UzLt"),h=s("NH3f"),p=(s("6iV/"),l.a,g.a,h.a,c()({},Object(d.c)(["token"])),s("6iV/"),{data:function(){return{totalPage:1,currentPage:0,status:this.getUrlParam("status"),choseDex:this.getUrlParam("choseDex")||null,orderNav:[{title:"全部",status:[10,20,30,40,50]},{title:"待付款",status:[10]},{title:"待发货",status:[20]},{title:"待收货",status:[30]},{title:"已完成",status:[40,50]}],orderList:[],ordersPageNo:1,ordersPageSize:10,moreOrders:!1,noOrders:!1,loading:!0}},components:{"v-nodata":l.a,vHeader:g.a,"v-footer":h.a},computed:c()({},Object(d.c)(["token"])),beforeCreate:function(){document.title="我的订单"},created:function(){this.verToken(),this.clearData(),this.getOrdersList()},methods:{verToken:function(){this.token||(this.showTip("登录超时，请重新登录"),this.$router.push({path:"/mine/login"}))},pageToDtail:function(t,e){this.$router.push("/goods/orderDetail?orderNo="+t+"&status="+e)},clearData:function(){this.currentPage=0,this.totalPage=1,this.noOrders=!1,this.loading=!0,this.orderList=[]},getStatusTxt:function(t){var e="";switch(t){case 10:e="等待买家付款";break;case 20:e="买家已付款";break;case 30:e="商家已发货";break;case 40:case 50:e="交易成功"}return e},getArrImg:function(t){var e=this;if(!t)return[];return t.forEach(function(t){t.goodsPhoto=e.api.urlPic+t.goodsPhoto.split(",")[0]}),t},tabOrderStatus:function(t,e){console.log(t),this.choseDex!==e&&(this.orderList=[],this.choseDex=e,this.clearData(),this.status="["+t.status+"]",this.getOrdersList())},loadMore:function(){this.loading=!0,this.ordersPageNo+=1,this.getOrdersList(),console.log(" 加载")},getOrdersList:function(t){var e=this;this.currentPage<=this.totalPage&&this.$axios.post(this.api.payOrderList,r()({status:JSON.parse(this.status),page:this.currentPage,limit:80}),{headers:{"content-type":"application/json",Authorization:this.token}}).then(function(s){var o=s.data;if(1===o.code){var a=o.content,i=a.list;if(e.currentPage=a.currPage+1,e.totalPage=a.totalPage,0===i.length)return e.orderList=[],e.noOrders=!0,void(e.loading=!0);i.forEach(function(t){var s={date:t.addTime,num:e.goodsCount(t.items),status:e.getStatusTxt(t.status),statusNum:t.status,storeName:t.storeName,storeId:t.storeId,totalPrice:t.totalPrice,deductedPrice:t.deductedPrice||null,conList:e.getArrImg(t.items),orderNo:t.orderNumberStr};e.orderList.push(s)}),pageCount<=e.ordersPageNo?(e.loading=!0,e.moreOrders=!1):(e.loading=!1,e.moreOrders=!0)}else t?e.noOrders=!0:(e.moreOrders=!0,e.loading=!1)}).catch(function(s){t?e.noOrders=!0:e.loading=!1})},goodsCount:function(t){var e=0,s=!0,o=!1,i=void 0;try{for(var r,n=a()(t);!(s=(r=n.next()).done);s=!0){e+=r.value.goodsCount}}catch(t){o=!0,i=t}finally{try{!s&&n.return&&n.return()}finally{if(o)throw i}}return e},pageToCenter:function(t,e,s){var o=this;s=s||0;var a=this.orderList,i={};switch(t){case"exp":i.tip="没有查询到物流信息",i.key="expList",i.url="/goods/ordercenter?from=orders&type=exp";break;case"eva":i.tip="没有查询到可评价的商品",i.key="evaList",i.url="/goods/ordercenter?from=orders&type=eva"}0!=a.length?(a[e].conList=a[e].conList[s],sessionStorage.setItem(i.key,r()(a[e])),console.log(JSON.parse(sessionStorage.getItem(i.key))),setTimeout(function(){o.$router.push(i.url)},0)):this.showTip(i.tip)},receiptOrder:function(t,e){var s=this;Object(u.MessageBox)({title:"收货提示",message:"您确定收到货品了吗？",showCancelButton:!0}).then(function(o){"confirm"===o&&s.$axios.get(s.api.receptGoods+t,{headers:{Authorization:s.token}}).then(function(t){var o=t.data;1===o.code?(s.showTip("确认收货成功！",2e3,"ok"),s.orderList.splice(e,1),0===s.orderList.length&&(s.ordersPageNo+=1,s.getOrdersList())):s.showTip(o.message)}).catch(function(t){s.showTip("确认收货失败，请稍后重试")})})},cancelOrder:function(t,e){var s=this;console.log(t),Object(u.MessageBox)({title:"取消提示",message:"您确定要取消此订单吗？",showCancelButton:!0}).then(function(o){"confirm"===o&&s.$axios.get(s.api.cancelOrder+t,{headers:{Authorization:s.token}}).then(function(t){1===t.data.code?(s.showTip("取消订单成功"),s.orderList.splice(e,1),0===s.orderList.length&&(s.ordersPageNo+=1,s.getOrdersList())):s.showTip("取消失败，请稍后重试")}).catch(function(t){s.showTip("取消失败，请稍后重试")})})},onPayOrder:function(t,e){var s=this,o=Object(u.Toast)({message:"支付中...",iconClass:"loading",duration:3e4});this.$axios.post(this.api.payOrder,r()({channel:2,orderNumbers:t,payType:"wxpublicpay"}),{headers:{"content-type":"application/json",Authorization:this.token}}).then(function(t){o.close();var e=t.data;if(1===e.code){var a=e.content,i={appId:a.appid,timeStamp:a.timestamp,nonceStr:a.nonceStr,package:a.packages,signType:"MD5",paySign:a.paySign};s.weiXinPay(i)}else s.showTip("支付失败，请稍后重试")}).catch(function(t){o.close(),s.showTip("支付失败，请稍后重试")})},weiXinPay:function(t){var e=this;function s(){WeixinJSBridge.invoke("getBrandWCPayRequest",t,function(t){"get_brand_wcpay_request:ok"==t.err_msg?(e.showTip("支付成功",2e3,"ok"),e.orderList.splice(index,1),0===e.orderList.length&&(e.ordersPageNo+=1,e.getOrdersList())):"get_brand_wcpay_request:cancel"==t.err_msg?e.showTip("您已取消支付"):e.showTip("支付失败，请重试")})}"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",s,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",s),document.attachEvent("onWeixinJSBridgeReady",s)):s()},pageToPay:function(t,e,s){if(10===s){var o="/goods/pay?orderNumbers="+e+"&payPrice="+t;this.$router.push(o)}else vue.showTip("跳转商品详情")},refundOrder:function(t){var e=this;Object(u.MessageBox)({title:"退款提示",message:"目前还不支持退款，您可以拨打客服电话进行相关操作！",showCancelButton:!0}).then(function(t){"confirm"===t&&e.callService()})},callHelp:function(){this.callService()}}}),v={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"wrapper page-orders"},[s("vHeader",{attrs:{title:"我的订单"}}),t._v(" "),s("div",{staticClass:"tab-nav"},t._l(t.orderNav,function(e,o){return s("div",{key:o,staticClass:"item",class:{active:o==t.choseDex},on:{click:function(s){t.tabOrderStatus(e,o)}}},[t._v("\n      "+t._s(e.title)+"\n    ")])}),0),t._v(" "),s("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.loadMore,expression:"loadMore"}],staticClass:"tab-con",attrs:{"infinite-scroll-disabled":"loading","infinite-scroll-distance":"100"}},[t._l(t.orderList,function(e,o){return s("div",{key:o,staticClass:"order-item"},[s("div",{staticClass:"goods-status vux-1px-b"},[s("div",{staticClass:"date"},[s("i",{staticClass:"ico i-store"}),t._v(t._s(e.storeName)+"\n        ")]),t._v(" "),10==e.statusNum?s("span",{staticClass:"status",on:{click:function(s){t.cancelOrder(e.orderNo,o)}}},[t._m(0,!0)]):t._e()]),t._v(" "),t._l(e.conList,function(a,i){return s("div",{staticClass:"goods-list relative item pda15 justify-content-space-between",on:{click:function(s){t.pageToDtail(e.orderNo,e.statusNum)}}},[s("div",{staticClass:"conPic"},[s("img",{attrs:{src:a.goodsPhoto}})]),t._v(" "),s("div",{staticClass:"flexg2 listRight"},[s("p",{staticClass:"goodsName txt-black-real",domProps:{textContent:t._s(a.goodsName)}}),t._v(" "),s("div",{staticClass:"rightBtm"},[s("div",{staticClass:"txt-black1 flexBox  justify-content-space-between"},[s("p",{staticClass:"per50"},[s("i",{domProps:{textContent:t._s("实付：¥"+a.totalPrice)}}),e.conList.length>1&&(40==e.statusNum||50==e.statusNum)?s("i",{staticClass:"ml5 txt-gray1",domProps:{textContent:t._s("数量："+a.goodsCount)}}):t._e()]),t._v(" "),1==e.conList.length||40!=e.statusNum&50!=e.statusNum?s("p",{staticClass:"per50 txt-right",attrs:{name:e.statusNum},domProps:{textContent:t._s("数量："+a.goodsCount)}}):s("div",{},[a.isComment?t._e():s("button",{staticClass:"btn-act",on:{click:function(e){e.stopPropagation(),t.pageToCenter("eva",o,i)}}},[t._v("立即评价")]),t._v(" "),50==e.statusNum||a.isComment?s("button",{staticClass:"btn-act",on:{click:function(s){s.stopPropagation(),t.callHelp(e.orderNo)}}},[t._v("申请售后")]):t._e()])])])])])}),t._v(" "),s("div",{staticClass:"goods-info"},[s("span",[t._v("下单时间："+t._s(e.date))]),t._v(" "),s("div",{staticClass:"price-info"},[t._v("\n          共"+t._s(e.num)+"件商品\n        ")])]),t._v(" "),s("div",{staticClass:"goods-action"},[s("div",[t._v("合计："),s("span",{staticClass:"price txt-orange"},[t._v("￥"+t._s(e.totalPrice))]),e.deductedPrice?s("span",{staticClass:"txt-gray"},[t._v("("+t._s("抵扣积分"+e.deductedPrice)+")")]):t._e()]),t._v(" "),s("div",[10==e.statusNum?s("button",{staticClass:"btn-act",on:{click:function(s){t.pageToPay(e.totalPrice,e.orderNo,e.statusNum)}}},[t._v("继续支付")]):t._e(),t._v(" "),20==e.statusNum?s("button",{staticClass:"btn-act",on:{click:function(s){t.refundOrder(e.orderNo)}}},[t._v("退款")]):t._e(),t._v(" "),30==e.statusNum?s("button",{staticClass:"btn-act",on:{click:function(s){t.receiptOrder(e.orderNo,o)}}},[t._v("确认收货")]):t._e(),t._v(" "),30==e.statusNum?s("button",{staticClass:"btn-act",on:{click:function(e){t.pageToCenter("exp",o)}}},[t._v("查看物流")]):t._e(),t._v(" "),40==e.statusNum&&1==e.conList.length?s("button",{staticClass:"btn-act",on:{click:function(e){t.pageToCenter("eva",o)}}},[t._v("立即评价")]):t._e(),t._v(" "),50==e.statusNum&&1==e.conList.length?s("button",{staticClass:"btn-act",on:{click:function(s){t.callHelp(e.orderNo)}}},[t._v("申请售后")]):t._e()])])],2)}),t._v(" "),t.noOrders?s("v-nodata",{attrs:{bgcolor:"grey",text:"- 暂无相关订单 -"}}):t._e()],2),t._v(" "),s("v-footer",{attrs:{active:"orders"}})],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"act"},[e("i",{staticClass:"ico i-del2"})])}]};var f=s("C7Lr")(p,v,!1,function(t){s("BEVu")},null,null);e.default=f.exports}});
//# sourceMappingURL=35.81a91ea8a9e7ec338218.js.map