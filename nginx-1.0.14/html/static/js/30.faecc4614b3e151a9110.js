webpackJsonp([30],{YxqW:function(t,e){},pw58:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("HzJ8"),o=s.n(a),i=s("3cXf"),r=s.n(i),n=s("4YfN"),c=s.n(n),l=s("9rMa"),u=s("wSez"),d=s("Gsn1"),p=s("XzeJ"),h=s("9yBd"),v=s("UzLt"),g=s("NH3f"),f=(s("6iV/"),h.a,v.a,g.a,d.a,p.a,c()({},Object(l.c)(["token"])),s("6iV/"),{data:function(){return{totalPage:1,currentPage:1,urlPic:this.api.urlPic,show:!1,storeData:"",pullupEnabled:!0,statusLoad:{pullupStatus:"default"},status:this.getUrlParam("status"),choseDex:this.getUrlParam("choseDex")||null,orderNav:[{title:"待付款",status:10},{title:"待接单",status:20},{title:"待发货",status:30},{title:"待收货",status:40},{title:"待评价",status:50}],orderList:[],ordersPageNo:1,ordersPageSize:10,moreOrders:!1,noOrders:!1,loadMoreVal:!0,loading:!0}},components:{"v-nodata":h.a,vHeader:v.a,"v-footer":g.a,Scroller:d.a,Spinner:p.a},computed:c()({},Object(l.c)(["token"])),beforeCreate:function(){document.title="我的订单"},created:function(){this.verToken(),this.clearData(),this.getOrdersList()},methods:{goMap:function(t,e){this.$router.push({path:"/map",query:{title:t,latitude:e.latitude,longitude:e.longitude,address:e.merchantAddress,merchantName:e.merchantName}})},callService:function(t){window.location.href="tel:"+t},toastMap:function(t){var e=this;this.storeData="",this.$axios.get(this.api.sellerstoreData+t).then(function(t){if(1===t.data.code){var s=t.data.content;e.storeData=s,e.show=!0}}).catch(function(t){e.showTip("网络错误")})},closePickerBox:function(){this.show=!1},verToken:function(){this.token||(this.showTip("登录超时，请重新登录"),this.$router.push({path:"/mine/login"}))},pageToDtail:function(t,e){this.$router.push("/store/orderDetail?orderNo="+t+"&status="+e)},clearData:function(){this.currentPage=1,this.totalPage=1,this.noOrders=!1,this.loading=!0,this.orderList=[]},getStatusTxt:function(t){var e="";switch(t){case 10:e="下单未支付";break;case 20:e="下单已支付";break;case 30:e="商户接单";break;case 40:e="配送订单";break;case 50:e="配送完成";break;case 60:e="订单已完成"}return e},getArrImg:function(t){var e=this;if(!t)return[];return t.forEach(function(t){t.goodsPhoto=e.api.urlPic+t.goodsPhoto.split(",")[0]}),t},tabOrderStatus:function(t,e){var s=this;this.choseDex!==e&&(this.orderList=[],this.totalPage=1,this.currentPage=1,this.choseDex=e,this.clearData(),this.status=t.status,this.getOrdersList(),setTimeout(function(){s.orderList&&(s.$refs.scroller.$el.children[0].style.cssText="transform-origin: 0px 0px 0px; transform: translateX(0px) translateY(0px) translateZ(0px) scale(1, 1); transition: none 0s ease 0s;")},0))},loadMore:function(){var t=this;this.loadMoreVal&&(this.loadMoreVal=!1,setTimeout(function(){t.loadMoreVal=!0},1e3),this.loading=!0,this.ordersPageNo+=1,this.getOrdersList(),console.log(" 加载"))},getOrdersList:function(t){var e=this,s={};s=this.status?{status:this.status,page:this.currentPage,limit:8}:{page:this.currentPage,limit:8},this.currentPage<=this.totalPage?this.$axios.post(this.api.otoOrderformList,r()(s),{headers:{"content-type":"application/json",Authorization:this.token}}).then(function(s){var a=s.data;if(1===a.code){var o=a.content,i=o.list;if(e.currentPage=o.currPage+1,e.totalPage=o.totalPage,0===i.length)return e.orderList=null,e.noOrders=!0,void(e.loading=!0);i.forEach(function(t){var s={date:t.addTime,num:e.goodsCount(t.items),status:e.getStatusTxt(t.status),statusNum:t.status,storeName:t.storeName,sendType:t.sendType,storeLogo:e.urlPic+t.storeLogo,storePhone:t.storePhone,storeId:t.storeId,totalPrice:t.totalPrice,deductedPrice:t.deductedPrice||null,conList:e.getArrImg(t.items),orderNo:t.orderNumber};e.orderList.push(s)}),pageCount<=e.ordersPageNo?(e.loading=!0,e.moreOrders=!1):(e.loading=!1,e.moreOrders=!0)}else t?e.noOrders=!0:(e.moreOrders=!0,e.loading=!1)}).catch(function(s){t?e.noOrders=!0:e.loading=!1}):(this.statusLoad.pullupStatus="complete",setTimeout(function(){e.statusLoad.pullupStatus="default"},1e3),console.log("已加载完"))},goodsCount:function(t){var e=0,s=!0,a=!1,i=void 0;try{for(var r,n=o()(t);!(s=(r=n.next()).done);s=!0){e+=r.value.goodsCount}}catch(t){a=!0,i=t}finally{try{!s&&n.return&&n.return()}finally{if(a)throw i}}return e},pageToCenter:function(t,e){var s=this,a=this.orderList,o={};switch(t){case"exp":o.tip="没有查询到物流信息",o.key="expList",o.url="/store/evaStore?from=orders&type=exp";break;case"eva":o.tip="没有查询到可评价的商品",o.key="evaList",o.url="/store/evaStore?from=orders&type=eva"}0!=a.length?(sessionStorage.setItem(o.key,r()(a[e])),console.log(a[e]),setTimeout(function(){s.$router.push(o.url)},0)):this.showTip(o.tip)},receiptOrder:function(t,e){var s=this;Object(u.MessageBox)({title:"收货提示",message:"您确定收到货品了吗？",showCancelButton:!0}).then(function(a){"confirm"===a&&s.$axios.get(s.api.receptGoods+t,{headers:{Authorization:s.token}}).then(function(t){var a=t.data;1===a.code?(s.showTip("确认收货成功！",2e3,"ok"),s.orderList.splice(e,1),0===s.orderList.length&&(s.ordersPageNo+=1,s.getOrdersList())):s.showTip(a.message)}).catch(function(t){s.showTip("确认收货失败，请稍后重试")})})},cancelOrder:function(t){var e=this;Object(u.MessageBox)({title:"取消提示",message:"您确定要取消此订单吗？",showCancelButton:!0}).then(function(s){"confirm"===s&&e.$axios.get(e.api.otoCancelOrder+t.orderNo,{headers:{Authorization:e.token}}).then(function(s){var a=s.data;1===a.code?(t.statusNum=0,e.showTip("取消订单成功")):e.showTip(a.msg)}).catch(function(t){e.showTip("取消失败，请稍后重试")})})},onPayOrder:function(t,e){var s=this,a=Object(u.Toast)({message:"支付中...",iconClass:"loading",duration:3e4});this.$axios.post(this.api.payOrder,r()({channel:2,orderNumbers:t,payType:"wxpublicpay"}),{headers:{"content-type":"application/json",Authorization:this.token}}).then(function(t){a.close();var e=t.data;if(1===e.code){var o=e.content,i={appId:o.appid,timeStamp:o.timestamp,nonceStr:o.nonceStr,package:o.packages,signType:"MD5",paySign:o.paySign};s.weiXinPay(i)}else s.showTip("支付失败，请稍后重试")}).catch(function(t){a.close(),s.showTip("支付失败，请稍后重试")})},weiXinPay:function(t){var e=this;function s(){WeixinJSBridge.invoke("getBrandWCPayRequest",t,function(t){"get_brand_wcpay_request:ok"==t.err_msg?(e.showTip("支付成功",2e3,"ok"),e.orderList.splice(index,1),0===e.orderList.length&&(e.ordersPageNo+=1,e.getOrdersList())):"get_brand_wcpay_request:cancel"==t.err_msg?e.showTip("您已取消支付"):e.showTip("支付失败，请重试")})}"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",s,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",s),document.attachEvent("onWeixinJSBridgeReady",s)):s()},pageToPay:function(t,e,s){if(10===s){var a="/store/otoPay?orderNumbers="+e+"&payPrice="+t;this.$router.push(a)}else vue.showTip("跳转商品详情")},refundOrder:function(t){var e=this;Object(u.MessageBox)({title:"退款提示",message:"目前还不支持退款，您可以拨打客服电话进行相关操作！",showCancelButton:!0}).then(function(t){"confirm"===t&&e.callService()})},callHelp:function(){this.callService()}}}),m={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"wrapper page-orders"},[s("vHeader",{attrs:{title:"我的订单"}}),t._v(" "),s("div",{staticClass:"tab-nav vux-1px-b"},t._l(t.orderNav,function(e,a){return s("div",{key:a,staticClass:"item",class:{active:a==t.choseDex},on:{click:function(s){t.tabOrderStatus(e,a)}}},[t._v("\n      "+t._s(e.title)+"\n    ")])}),0),t._v(" "),s("div",{staticClass:"tab-con mt43 page-buy odBoxTop"},[t.orderList?s("scroller",{ref:"scroller",attrs:{"lock-x":"",height:"-140","scrollbar-y":!1,"use-pullup":""},on:{"on-scroll-bottom":t.loadMore,"on-pullup-loading":t.loadMore},model:{value:t.statusLoad,callback:function(e){t.statusLoad=e},expression:"statusLoad"}},[s("div",{staticClass:"white pda15"},t._l(t.orderList,function(e,a){return t.orderList?s("div",{key:a,staticClass:"order-item odBox"},[s("router-link",{staticClass:"lay-address white justify-content-space-between vux-1px-b",attrs:{to:{path:"/store/orderDetail",query:{orderNo:e.orderNo,status:e.statusNum}}}},[s("div",{staticClass:"horizontal-view"},[s("i",{staticClass:"ico storeHead"},[s("img",{attrs:{src:e.storeLogo?e.storeLogo:""}})]),t._v(" "),s("div",{staticClass:"adress storeTip vertical-view"},[s("span",{staticClass:"name-phone lh-20 fs-14 bold txt-black storeTitle"},[t._v(t._s(e.storeName))]),t._v(" "),s("span",{staticClass:"adres fs-12 txt-gray"},[t._v(t._s(e.date))])])]),t._v(" "),s("div",[0==e.statusNum?s("span",{staticClass:"txt-gray1 fs-12"},[t._v("订单已取消")]):t._e(),t._v(" "),10==e.statusNum?s("span",{staticClass:"txt-orange fs-12"},[t._v("订单未付款")]):t._e(),t._v(" "),20==e.statusNum?s("span",{staticClass:"txt-blue1 fs-12"},[t._v("等待商家接单")]):t._e(),t._v(" "),4==e.sendType&&30==e.statusNum?s("span",{staticClass:"txt-blue1 fs-12"},[t._v("到店自取")]):t._e(),t._v(" "),1==e.sendType&&30==e.statusNum?s("span",{staticClass:"txt-blue1 fs-12"},[t._v("等待商家配送")]):t._e(),t._v(" "),40==e.statusNum?s("span",{staticClass:"txt-blue1 fs-12"},[t._v("正在配送中")]):t._e(),t._v(" "),50==e.statusNum?s("span",{staticClass:"txt-blue1 fs-12"},[t._v("配送已完成")]):t._e(),t._v(" "),60==e.statusNum?s("span",{staticClass:"txt-gray1 fs-12"},[t._v("订单已完成")]):t._e(),t._v(" "),s("i",{staticClass:"ico i-aow"})])]),t._v(" "),s("div",{staticClass:"flexg2 listRight pda15 justify-content-space-between"},[e.conList[0].goodsName?s("p",{staticClass:"txt-black-real"},[s("span",{domProps:{textContent:t._s(t.limitStrFormat(e.conList[0].goodsName)+" ")}}),t._v("等 "+t._s(e.num)+"件商品")]):t._e(),t._v(" "),s("p",{staticClass:"fs-12 txt-black-real"},[t._v("￥"+t._s(t.dotFormat2(e.totalPrice)))])]),t._v(" "),s("div",{staticClass:"goods-action pdb10 justify-content-space-between"},[s("div",{on:{click:function(e){t.deleteOrder()}}},[s("i",{staticClass:"ico i-del2 hide"})]),t._v(" "),s("div",{staticClass:"txt-right"},[10==e.statusNum?s("button",{staticClass:"btn-act active",on:{click:function(s){t.cancelOrder(e)}}},[t._v("取消订单")]):t._e(),t._v(" "),10==e.statusNum?s("button",{staticClass:"btn-act",on:{click:function(s){t.pageToPay(e.totalPrice,e.orderNo,e.statusNum)}}},[t._v("继续支付")]):t._e(),t._v(" "),30==e.statusNum?s("button",{staticClass:"btn-act connectStore relative",on:{click:function(s){t.callService(e.storePhone)}}},[t._v("联系商家")]):t._e(),t._v(" "),4==e.sendType&&30==e.statusNum?s("button",{staticClass:"btn-act odLocation relative",on:{click:function(s){t.toastMap(e.storeId)}}},[t._v("导航")]):t._e(),t._v(" "),50==e.statusNum?s("button",{staticClass:"btn-act",on:{click:function(e){t.pageToCenter("eva",a)}}},[t._v("评论订单")]):t._e()])])],1):t._e()}),0),t._v(" "),s("div",{staticClass:"xs-plugin-pullup-container xs-plugin-pullup-up",staticStyle:{position:"absolute",width:"100%",height:"40px",bottom:"-20px","text-align":"center"},attrs:{slot:"pullup"},slot:"pullup"},[s("span",{directives:[{name:"show",rawName:"v-show",value:"default"===t.statusLoad.pullupStatus,expression:"statusLoad.pullupStatus === 'default'"}]}),t._v(" "),s("span",{directives:[{name:"show",rawName:"v-show",value:"up"===t.statusLoad.pullupStatus,expression:"statusLoad.pullupStatus === 'up'"}],staticClass:"pullup-arrow",class:{rotate:"up"===t.statusLoad.pullupStatus}},[t._v("↑")]),t._v(" "),s("span",{directives:[{name:"show",rawName:"v-show",value:"loading"===t.statusLoad.pullupStatus,expression:"statusLoad.pullupStatus === 'loading'"}]},[s("spinner",{attrs:{type:"ios-small"}})],1),t._v(" "),s("span",{directives:[{name:"show",rawName:"v-show",value:"complete"===t.statusLoad.pullupStatus,expression:"statusLoad.pullupStatus === 'complete'"}]},[t._v("已加载完成")])])]):t._e(),t._v(" "),null==t.orderList?s("v-nodata",{attrs:{bgcolor:"grey",text:"- 暂无相关订单 -"}}):t._e(),t._v(" "),s("div",{staticClass:"picker-new"},[s("div",{class:t.show?"picker-mask show":"picker-mask",on:{click:t.closePickerBox}}),t._v(" "),s("div",{class:t.show?"picker-panel show":"picker-panel"},[s("div",{staticClass:"h45 vux-1px-b relative titleEx"},[t._v("选择地图"),s("i",{staticClass:"txt-gray",on:{click:t.closePickerBox}},[t._v("×")])]),t._v(" "),s("div",{staticClass:"groupEx mb10 pda15 vertical-view"},[s("span",{staticClass:"fs-14 h40",on:{click:function(e){t.goMap("腾讯地图",t.storeData)}}},[t._v("腾讯地图")]),t._v(" "),s("span",{staticClass:"fs-14 h40",on:{click:function(e){t.goMap("百度地图",t.storeData)}}},[t._v("百度地图")]),t._v(" "),s("span",{staticClass:"fs-14 h40",on:{click:function(e){t.goMap("高德地图",t.storeData)}}},[t._v("高德地图")])])])])],1),t._v(" "),s("v-footer",{attrs:{active:"orders"}})],1)},staticRenderFns:[]};var _=s("C7Lr")(f,m,!1,function(t){s("YxqW")},null,null);e.default=_.exports}});
//# sourceMappingURL=30.faecc4614b3e151a9110.js.map