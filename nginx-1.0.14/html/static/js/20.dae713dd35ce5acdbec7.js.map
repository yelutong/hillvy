{"version":3,"sources":["webpack:///./src/views/mine/bind.vue","webpack:///./src/views/mine/bind.vue?be31","webpack:///./src/views/mine/bind.vue?ac28"],"names":["mine_bind","require","vHeader","computed","mapState","methods","mapActions","getCode","_this","this","bindInfo","hasSend","phone","length","$axios","get","api","getVerifyCode","then","res","resData","data","code","showTip","countDownTime","message","catch","_this2","fnCount","count","setTimeout","time","clearTimeout","bindPhone","_this3","loading","Toast","iconClass","duration","ajaxData","localStorage","getItem","JSON","parse","username","smsCode","proUserId","post","wxBind","stringify_default","headers","content-type","close","setUserIdBack","content","objData","atnToken","setItem","$router","push","ifUserBind","token","_this4","getUserInfo","Authorization","headimgurl","nickname","sex","components","beforeCreate","document","title","created","views_mine_bind","render","_vm","_h","$createElement","_c","_self","staticClass","attrs","_v","directives","name","rawName","value","expression","modifiers","trim","type","placeholder","maxlength","domProps","on","input","$event","target","composing","$set","blur","$forceUpdate","_e","click","_s","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/20.dae713dd35ce5acdbec7.js","sourcesContent":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { mapState, mapActions } from \"vuex\";\r\nimport { Toast } from \"mint-ui\";\r\nimport vHeader from \"@/components/v-header\";\r\nconst qs = require(\"qs\");\r\nexport default {\r\n  data() {\r\n    return {\r\n      bindInfo: {\r\n        phone: \"\",\r\n        code: \"\",\r\n        time: 60,\r\n        hasSend: false\r\n      },\r\n      headimgurl:'',//微信头像地址\r\n      nickname:'',//微信昵称\r\n      proUserId:'',//推荐人id\r\n      sex:'',//微信性别\r\n    };\r\n  },\r\n  components: {\r\n   vHeader\r\n  },\r\n  computed: {\r\n    ...mapState([\"token\", \"userId\", \"parentId\"])\r\n  },\r\n  beforeCreate() {\r\n    document.title = \"手机登录\";\r\n  },\r\n  created() {},\r\n  methods: {\r\n    ...mapActions([\"atnOpenId\",\"atnToken\",\"atnProUserId\"]),\r\n    // 获取验证码\r\n    getCode() {\r\n      const bindInfo = this.bindInfo;\r\n      if (bindInfo.hasSend) {\r\n        return;\r\n      }\r\n      if (bindInfo.phone.length !== 11) {\r\n        this.showTip(\"手机号码格式不正确\");\r\n        return;\r\n      }\r\n      this.$axios\r\n        .get(this.api.getVerifyCode+bindInfo.phone)\r\n        .then(res => {\r\n          const resData = res.data;\r\n          if (resData.code !== 1) {\r\n            this.showTip(resData.message);\r\n            return;\r\n          }\r\n          // 成功之后改变颜色，60秒后可再次发送\r\n          this.bindInfo.hasSend = true;\r\n          this.showTip(\"验证码已发送到您的手机，请注意查收\");\r\n          this.countDownTime();\r\n        })\r\n        .catch(res => {\r\n          this.showTip(\"获取验证码失败，请稍后重试\");\r\n        });\r\n    },\r\n    // 验证码倒计时\r\n    countDownTime() {\r\n      let fnCount = () => {\r\n        let count = setTimeout(() => {\r\n          if (this.bindInfo.time <= 0) {\r\n            clearTimeout(count);\r\n            this.bindInfo.hasSend = false;\r\n            this.bindInfo.time = 120;\r\n          } else {\r\n            this.bindInfo.time -= 1;\r\n            fnCount();\r\n          }\r\n        }, 1000);\r\n      };\r\n      fnCount();\r\n    },\r\n    // 注册绑定手机号\r\n    bindPhone() {\r\n      const bindInfo = this.bindInfo;\r\n      if (bindInfo.phone.length !== 11) {\r\n        this.showTip(\"手机号码格式不正确\");\r\n        return;\r\n      }\r\n      if (bindInfo.code === \"\") {\r\n        this.showTip(\"请输入验证码\");\r\n        return;\r\n      }\r\n      const loading = Toast({\r\n        message: \"绑定中...\",\r\n        iconClass: \"loading\",\r\n        duration: 30000\r\n      });\r\n     \r\n      let ajaxData = localStorage.getItem('bindInfo');\r\n      ajaxData = JSON.parse(ajaxData);\r\n      ajaxData.username = bindInfo.phone;\r\n      ajaxData.smsCode = bindInfo.code;\r\n      ajaxData.proUserId = localStorage.getItem('proUserId');\r\n      let code = '';\r\n      this.$axios\r\n        .post(this.api.wxBind+code, JSON.stringify(ajaxData),{\r\n          headers: {\"content-type\": \"application/json\"}\r\n        })\r\n        .then(res => {\r\n          loading.close();\r\n          const resData = res.data;\r\n          if (resData.code === 1) {\r\n             // 绑定成功后\r\n            this.setUserIdBack(resData.content)\r\n          }else{\r\n            this.showTip(resData.message);\r\n            return;\r\n          }\r\n         \r\n        })\r\n        .catch(res => {\r\n          loading.close();\r\n          this.showTip(\"绑定失败，请稍后重试\");\r\n        });\r\n    },\r\n    // 存储userId和微信信息后返回\r\n    setUserIdBack(objData) {\r\n      this.atnToken(objData);\r\n      localStorage.setItem('token', objData)\r\n      const bindOk = Toast({\r\n        message: \"绑定成功！\",\r\n        iconClass: \"ok\",\r\n        duration: 2000\r\n      });\r\n      \r\n      this.$router.push(\"/mine\");\r\n    },\r\n    // 查询是否存在userId\r\n    ifUserBind(token) {\r\n      this.$axios\r\n        .get(this.api.getUserInfo, { headers: { \"Authorization\": token } })\r\n        .then(res => {\r\n          const resData = res.data;\r\n          // 如果接口成功且有数据，则已经绑定了，就存储再跳\r\n          if (resData.code === 1 && !!resData.content) {\r\n            this.setUserIdBack(resData.content);\r\n          }\r\n        });\r\n    }\r\n  }\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/views/mine/bind.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"wrapper white page-bind\"},[_c('vHeader',{attrs:{\"title\":\"绑定\"}}),_vm._v(\" \"),_c('div',{staticClass:\"item-bind\"},[_c('i',{staticClass:\"ico i-phone\"}),_vm._v(\" \"),_c('input',{directives:[{name:\"model\",rawName:\"v-model.trim\",value:(_vm.bindInfo.phone),expression:\"bindInfo.phone\",modifiers:{\"trim\":true}}],staticClass:\"ipt\",attrs:{\"type\":\"number\",\"placeholder\":\"请输入手机号\",\"maxlength\":\"11\"},domProps:{\"value\":(_vm.bindInfo.phone)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.bindInfo, \"phone\", $event.target.value.trim())},\"blur\":function($event){_vm.$forceUpdate()}}})]),_vm._v(\" \"),_c('div',{staticClass:\"item-bind\"},[_c('i',{staticClass:\"ico i-lock\"}),_vm._v(\" \"),_c('input',{directives:[{name:\"model\",rawName:\"v-model.trim\",value:(_vm.bindInfo.code),expression:\"bindInfo.code\",modifiers:{\"trim\":true}}],staticClass:\"ipt\",attrs:{\"type\":\"number\",\"placeholder\":\"请输入验证码\",\"maxlength\":\"11\"},domProps:{\"value\":(_vm.bindInfo.code)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.bindInfo, \"code\", $event.target.value.trim())},\"blur\":function($event){_vm.$forceUpdate()}}}),_vm._v(\" \"),(!_vm.bindInfo.hasSend)?_c('button',{staticClass:\"btn-submit btn-code\",on:{\"click\":_vm.getCode}},[_vm._v(\"获取验证码\")]):_vm._e(),_vm._v(\" \"),(_vm.bindInfo.hasSend)?_c('div',{staticClass:\"cut-time\"},[_vm._v(\"剩余 \"+_vm._s(_vm.bindInfo.time)+\" s\")]):_vm._e()]),_vm._v(\" \"),_c('button',{staticClass:\"btn-submit btn-bind flex1\",on:{\"click\":_vm.bindPhone}},[_vm._v(\"绑 定\")])],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/_vue-loader@13.7.3@vue-loader/lib/template-compiler?{\"id\":\"data-v-d0b026fe\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/_vux-loader@1.2.9@vux-loader/src/before-template-compiler-loader.js!./node_modules/_vux-loader@1.2.9@vux-loader/src/template-loader.js!./node_modules/_vue-loader@13.7.3@vue-loader/lib/selector.js?type=template&index=0!./src/views/mine/bind.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/_extract-text-webpack-plugin@3.0.2@extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/_vue-loader@13.7.3@vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-d0b026fe\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!px2rem-loader?{\\\"remUnit\\\":50}!stylus-loader?{\\\"sourceMap\\\":true}!../../../node_modules/_vux-loader@1.2.9@vux-loader/src/style-loader.js!../../../node_modules/_vue-loader@13.7.3@vue-loader/lib/selector?type=styles&index=0!./bind.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/_vue-loader@13.7.3@vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/_vux-loader@1.2.9@vux-loader/src/script-loader.js!../../../node_modules/_vux-loader@1.2.9@vux-loader/src/script-loader.js!../../../node_modules/_vue-loader@13.7.3@vue-loader/lib/selector?type=script&index=0!./bind.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/_vux-loader@1.2.9@vux-loader/src/script-loader.js!../../../node_modules/_vue-loader@13.7.3@vue-loader/lib/selector?type=script&index=0!./bind.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/_vue-loader@13.7.3@vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-d0b026fe\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/_vux-loader@1.2.9@vux-loader/src/before-template-compiler-loader.js!../../../node_modules/_vux-loader@1.2.9@vux-loader/src/template-loader.js!../../../node_modules/_vue-loader@13.7.3@vue-loader/lib/selector?type=template&index=0!./bind.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/views/mine/bind.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}