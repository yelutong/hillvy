<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
		<title>选择奖品收货地址</title>
		<link rel="shortcut icon" href="images/favicon.ico" />
		<link rel="stylesheet" href="min_css/public.css">
		<link rel="stylesheet" href="min_css/content.css">
		<link rel="stylesheet" href="min_css/detail.css">
		<link rel="stylesheet" href="min_css/shopcar.css">
		<link rel="stylesheet" href="min_css/user.css">
		<link rel="stylesheet" href="min_css/font-awesome.min.css">
	</head>

	<body>
		<header class="header-box">
			<div class="header-menu" id="headerMenu">
				<span class="logo">选择奖品收货地址</span>
				<div class="header-icon left-icon">
					<a href="javascript:window.history.back()" class="icon_bk sprite" ></a>
				</div>
				 <div class="header-icon right-icon">
					<a href="index.html" class="icon"><i class="sprite gosy"></i></a>
				</div>
			</div>
		</header>
		<div class="content21 sca" id="app">

			<div>  
				<div id="1163" class="myaddress2 chadd" v-if="defaultAddress">
					<input type="hidden" id="areaId" :value="defaultAddress.id" />
					<span class="name" v-text="defaultAddress.userName"></span>
					<span class="num" v-text="defaultAddress.phone"></span>
					<span class="address" v-text="defaultAddress.address"></span>
					<span class="shop_address_edit"><a href="address.html?id=21"><i class="fa fa-pencil-square-o color3" style="font-size:20px"></i></a></span>
				</div>
			</div>
			<div class="confirm">

				<ul>
					<div class="cart_headerbox">
						<img alt="" src="images/icon-kin.png" width="100%;" style="border: 0;vertical-align:text-bottom">
						<span class="cart_storename">奖品信息</span>
					</div>
					<template v-if="userAward.length>0" v-for="goods in userAward">
						<li class="order_listyle userAwardLi">
							<div class="shop_img">
								<img alt="" src="https://m.mcyou.net/images/award.jpg" width="100%">
							</div>
							<div style="width: 70%;float: left;display:block;">
								<div class="shop_name ct_active" v-text="goods.awardContent"></div>
								<div class="shop_select">
									<div class="shop-brief">
										<!--<span>重量:3.3kg</span><span>颜色:标配版</span><span>版本:13.3英寸</span>--> 
									</div>
								</div>
								<div class="shop_money ct_active"></div>
								<div class="shop_num">中奖时间:<b v-text="goods.addTime"></b></div>
							</div>
						</li>
					</template>
					<template v-if="actsignlist.id">
						<li class="order_listyle userAwardLi">
							<div class="shop_img">
								<img alt="" src="https://m.mcyou.net/images/award.jpg" width="100%">
							</div>
							<div style="width: 70%;float: left;display:block;">
								<div class="shop_name ct_active" v-text="actsignlist.awardContent"></div>
								<div class="shop_select">
									<div class="shop-brief">
										<!--<span>重量:3.3kg</span><span>颜色:标配版</span><span>版本:13.3英寸</span>--> 
									</div>
								</div>
								<div class="shop_money ct_active"></div>
								<div class="shop_num">连续签到<b v-text="actsignlist.signDays"></b>天</div>
							</div>
						</li> 
					</template>	
				</ul>
			 
                
                <div class="payment-bar">
                
                <div class="shop-total f16">备注：<label class="color2 f16 ct_active"><b>运费到付</b></label></div> 
                <a href="javascript:void(0)" class="settlement" @click="saveAwardBtn(actsignlist.isDisplay)">确定</a>
                
                </div>
                 

			</div> 
</div> 
<div id="Msg"></div>
<div class="mb_bg"></div>  
</body> 
</html>
<script type="text/javascript" src="min_js/jquery-1.10.1.min.js"></script>
<script type="text/javascript" src="min_js/publick.js"></script>
<script type="text/javascript" src="min_js/api.js"></script>
<script type="text/javascript" src="min_js/detail.js"></script>
<script type="text/javascript" src="min_js/commonUtil.js"></script>
<script type="text/javascript" src="min_js/jquery.md5.js"></script>
<script type="text/javascript" src="min_js/vue.min.js"></script>
<script>
  $("footer").load("footer.html");  
</script> 
<script type="text/javascript">
	var vm = new Vue({
		el: '#app',
		data: {
			defaultAddress: {},
			oderInfoObj: {},
			couponList:{},
			toOrderform:{},
			platformCoupon:{},
			userAward:[],
			userAwardId:[],
			actsignlist:{},
			activitySignId:0
		},
		mounted: function() {
			this.$nextTick(function() {
				/*选择地址*/
				var chooseAddress = window.localStorage.getItem("chooseAddress");//获取地址address.html页面，选中的地址
				if(chooseAddress) {
					vm.defaultAddress = JSON.parse(window.localStorage.getItem("chooseAddress"));
					window.localStorage.setItem("chooseAddress", "");
				} else {
					/*获取默认地址*/
					commonUtil.request({
						url: defaultAddress,
						type: "get",
						contentType: "application/json",
						success: function(data) {
							console.log(data);
							//var data = JSON.parse(data);  
							if(data.code == 1) {
								vm.defaultAddress = data.content;
							}
						},
						beforeSend: function(request) {
							request.setRequestHeader("Authorization", window.localStorage.getItem("token"));
						}
					});
				}
				//奖品信息	
				
				if(window.sessionStorage.getItem("awardAc")){ 
					console.log("签到");
					vm.actsignlist=JSON.parse(window.sessionStorage.getItem("actsignlist"));
					console.log(vm.actsignlist); 
					vm.activitySignId=vm.actsignlist.id; 
				}else{ 
					console.log("抽奖");
					commonUtil.request({
					url: noaddressawardslist,
					dataType: "json",
					type: "get", 
					contentType: "application/json",
					success: function(data) {
						console.log(data);
						if(data.code == 1 && data.content.length>0) { 
							$.each(data.content,function(index,val){ 
								  if(val.awardType==1||val.awardType==5){ 
								      vm.userAward.push(val); 
									  vm.userAwardId.push(val.id);
							       }   
							})
							
							console.log(vm.userAward);
							console.log(vm.userAwardId); 
						}
					}

				   })
					
				} 
			})
		},

		methods: {
		    
			//下订单
			saveAwardBtn: function(obj) { 
			 var addressId=Number($("#areaId").val());
			 if(!addressId) {
				showmessage("地址不能为空");
				return false;
			  }	 
				
			if(obj==true){
				console.log(true);
				window.sessionStorage.removeItem("awardAc");
				commonUtil.request({
						url: takesignaward,
						type: "POST",
						data:{"addressId":addressId,"activitySignId":vm.activitySignId},
						contentType: "application/json",
						success: function(data) {
							if(data.code == 1) {
								showmessage("收货信息提交成功");  
								setTimeout(function(){ 
								   window.location.href = "order.html";
								},1800) 
								
							} else {
								showmessage(data.msg);
								setTimeout(function(){ 
								   window.location.href = "order.html";
								},1800) 
							}
						}

					});   
				
			}else{
				commonUtil.request({
						url: Awardaddress,
						type: "POST",
						data:{"addressId":addressId,"userAwardId":vm.userAwardId},
						contentType: "application/json",
						success: function(data) {
							if(data.code == 1) {
								showmessage("收货信息提交成功"); 
								setTimeout(function(){ 
								   window.location.href = "order.html";
								},1800) 
								
							} else {
								showmessage(data.msg);
								setTimeout(function(){ 
								   window.location.href = "order.html";
								},1800) 
							}
						}

					}); 
			}	
			
			}
		}
	});

</script>