$(function(){$(document).on("click",".minus",function(){var t=$(this).parent().find(".num");if(Number(t.text())>1){var goodsDom=$(this).parents(".shop-info").find(".goodsObj");var goods={};goods.goodsId=Number($(goodsDom).attr("goodsId"));goods.storeId=Number($(goodsDom).attr("storeId"));goods.goodsSku=$(goodsDom).attr("goodsSku");goods.id=Number($(goodsDom).attr("carId"));goods.goodsCount=Number($(this).parent().find(".num").text())-1;vm.updateGoodCount(goods)}else{return false}t.text(parseInt(t.text())-1);if(t.text()<=1){t.text(1)}TotalPrice()});$(document).on("click",".plus",function(){var t=$(this).parent().find(".num");t.text(parseInt(t.text())+1);if(t.text()<=1){t.text(1)}var goodsDom=$(this).parents(".shop-info").find(".goodsObj");var goods={};goods.goodsId=Number($(goodsDom).attr("goodsId"));goods.storeId=Number($(goodsDom).attr("storeId"));goods.id=Number($(goodsDom).attr("carId"));goods.goodsSku=$(goodsDom).attr("goodsSku");goods.goodsCount=Number($(this).parent().find(".num").text());vm.updateGoodCount(goods);TotalPrice()});$(document).on("click",".goodsCheck",function(){var goods=$(this).closest(".shop-group-item").find(".goodsCheck");var goodsC=$(this).closest(".shop-group-item").find(".goodsCheck:checked");var Shops=$(this).closest(".shop-group-item").find(".shopCheck");if(goods.length==goodsC.length){Shops.prop("checked",true);if($(".shopCheck").length==$(".shopCheck:checked").length){$("#AllCheck").prop("checked",true);TotalPrice()}else{$("#AllCheck").prop("checked",false);TotalPrice()}}else{Shops.prop("checked",false);$("#AllCheck").prop("checked",false);TotalPrice()}});$(document).on("click",".shopCheck",function(){if($(this).prop("checked")==true){$(this).parents(".shop-group-item").find(".goods-check").prop("checked",true);if($(".shopCheck").length==$(".shopCheck:checked").length){$("#AllCheck").prop("checked",true);TotalPrice()}else{$("#AllCheck").prop("checked",false);TotalPrice()}}else{$(this).parents(".shop-group-item").find(".goods-check").prop("checked",false);$("#AllCheck").prop("checked",false);TotalPrice()}});$(document).on("click","#AllCheck",function(){if($(this).prop("checked")==true){$(".goods-check").prop("checked",true);TotalPrice()}else{$(".goods-check").prop("checked",false);TotalPrice()}$(".shopCheck").change()});function TotalPrice(){var allprice=0;var storeList=[];var carIdList=[];$(".shop-group-item").each(function(){var oprice=0;var newstore={};newstore.goodsCarts=[];newstore.storeName=$(this).attr("storeName");newstore.storeId=$(this).attr("storeId");$(this).find(".goodsCheck").each(function(){if($(this).is(":checked")){var goodsDom=$(this).parents(".shop-info").find(".goodsObj");var goods={};goods.goodsId=$(goodsDom).attr("goodsId");goods.goodsName=$(goodsDom).attr("goodsName");goods.goodsSkuInfo=$(goodsDom).attr("goodsSkuInfo");if($(goodsDom).attr("goodsPhoto")){goods.goodsPhoto=$(goodsDom).attr("goodsPhoto").split(",")[0]}carIdList.push({"id":Number($(goodsDom).attr("carId"))});var num=parseInt($(this).parents(".shop-info").find(".num").text());var price=parseFloat($(this).parents(".shop-info").find(".price").text());var total=price*num;oprice+=total;goods.price=price;goods.num=num;newstore.oprice=oprice.toFixed(2);newstore.goodsCarts.push(goods)}$(this).closest(".shop-group-item").find(".ShopTotal").text(oprice.toFixed(2))});var oneprice=parseFloat($(this).find(".ShopTotal").text());allprice+=oneprice;if(newstore.goodsCarts.length>0){storeList.push(newstore)}});$("#AllTotal").text(allprice.toFixed(2));var oderInfo={};oderInfo.allprice=allprice.toFixed(2);oderInfo.storeList=storeList;oderInfo.carIdList=carIdList;window.localStorage.setItem("oderInfo",JSON.stringify(oderInfo));vm.allprice=allprice}});